<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Working Hardcore Punk Generator</title>
<style>
  body { background: #111; color: #eee; font-family: monospace; padding: 20px; }
  button { font-size: 18px; padding: 10px 20px; margin: 10px; cursor: pointer; }
  #status { margin-top: 20px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: #222; padding: 10px; }
</style>
</head>
<body>

<h1>Hardcore Punk Generator — With Drums & Bass Sound</h1>
<button id="startBtn">▶️ Start</button>
<button id="stopBtn">⏹ Stop</button>
<div id="status">Waiting to start...</div>

<script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.min.js"></script>
<script>
  const status = document.getElementById("status");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");

  Tone.Transport.bpm.value = 210; // hardcore punk tempo

  // Guitar synth with distortion
  const guitar = new Tone.PolySynth(Tone.Synth, {
    oscillator: { type: "square" },
    envelope: { attack: 0.005, decay: 0.1, sustain: 0.2, release: 0.1 }
  }).chain(
    new Tone.Distortion(0.9),
    new Tone.Filter(800, "lowpass"),
    new Tone.Gain(0.7),
    Tone.Destination
  );

  // Bass synth with sawtooth wave
  const bass = new Tone.MonoSynth({
    oscillator: { type: "sawtooth" },
    envelope: { attack: 0.01, decay: 0.3, sustain: 0.4, release: 0.3 },
    filterEnvelope: { attack: 0.005, decay: 0.1, sustain: 0.7, release: 0.2, baseFrequency: 100, octaves: 2.6 },
    volume: -6
  }).toDestination();

  // Drum Sampler - Using reliable samples from ToneJS's public repo
  const drumSampler = new Tone.Sampler({
    urls: {
      C1: "kick.wav",
      D1: "snare.wav",
      E1: "hihat-open.wav",
      F1: "hihat-closed.wav"
    },
    baseUrl: "https://tonejs.github.io/audio/drum-samples/CR78/",
    onload: () => {
      status.textContent += "\nDrum samples loaded.";
      drumsReady = true;
    }
  }).toDestination();

  let drumsReady = false;
  let isPlaying = false;

  // Notes for guitar power chords (root + fifth)
  const powerChords = {
    A: ["A3", "E4"],
    C: ["C4", "G4"],
    D: ["D4", "A4"],
    E: ["E4", "B4"],
    G: ["G3", "D4"]
  };

  // Simple phrases - randomly select chords & bass notes
  function randomChord() {
    const keys = Object.keys(powerChords);
    return keys[Math.floor(Math.random() * keys.length)];
  }

  function playPhrase(time) {
    // Play 4 chords, one per quarter note
    for (let i = 0; i < 4; i++) {
      const chordRoot = randomChord();
      const chordNotes = powerChords[chordRoot];
      const chordTime = time + i * Tone.Time("4n").toSeconds();

      guitar.triggerAttackRelease(chordNotes, "8n", chordTime);

      // Bass plays root note an octave below
      const bassNote = chordRoot + "2";
      bass.triggerAttackRelease(bassNote, "8n", chordTime);
    }

    // Drum pattern: kick on 1 & 3, snare on 2 & 4, hi-hat 8th notes
    for (let i = 0; i < 8; i++) {
      const stepTime = time + i * Tone.Time("8n").toSeconds();

      if (i % 4 === 0 || i % 4 === 2) {
        drumSampler.triggerAttackRelease("C1", "16n", stepTime); // kick on 1 & 3
      }

      if (i % 4 === 1 || i % 4 === 3) {
        drumSampler.triggerAttackRelease("D1", "16n", stepTime); // snare on 2 & 4
      }

      // hi-hat closed every 8th note
      drumSampler.triggerAttackRelease("F1", "16n", stepTime);
    }
  }

  // Schedule phrases every measure indefinitely
  function scheduleLoop() {
    Tone.Transport.scheduleRepeat((time) => {
      if (!drumsReady) {
        status.textContent += "\nWaiting for drum samples to load...";
        return;
      }
      playPhrase(time);
      status.textContent += "\nPlaying phrase at " + time.toFixed(2) + " seconds";
      status.scrollTop = status.scrollHeight;
    }, "1m");
  }

  startBtn.onclick = async () => {
    if (isPlaying) return;
    isPlaying = true;
    status.textContent = "Starting audio context...";
    await Tone.start();
    status.textContent += "\nAudio context started.";
    if (!drumsReady) {
      status.textContent += "\nLoading drum samples...";
    }
    Tone.Transport.bpm.value = 210;
    Tone.Transport.start();
    scheduleLoop();
  };

  stopBtn.onclick = () => {
    if (!isPlaying) return;
    isPlaying = false;
    Tone.Transport.stop();
    Tone.Transport.cancel();
    status.textContent += "\nPlayback stopped.";
  };
</script>

</body>
</html>
