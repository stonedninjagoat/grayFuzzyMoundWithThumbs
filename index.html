<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Punk Jam with Synth Drums</title>
<style>
  body { background: #121212; color: #eee; font-family: monospace; padding: 20px; }
  button { font-size: 18px; padding: 10px 20px; margin: 10px; cursor: pointer; }
  #status { margin-top: 20px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: #222; padding: 10px; }
</style>
</head>
<body>

<h1>Simple Punk Jam — Synth Drums, Bass & Guitar</h1>
<button id="startBtn">▶️ Start</button>
<button id="stopBtn">⏹ Stop</button>
<div id="status">Waiting to start...</div>

<script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.min.js"></script>
<script>
  const status = document.getElementById("status");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");

  Tone.Transport.bpm.value = 210; // punk tempo
  Tone.Transport.loop = true;
  Tone.Transport.loopEnd = "1m";

  // Guitar synth with distortion
  const guitar = new Tone.PolySynth(Tone.Synth, {
    oscillator: { type: "square" },
    envelope: { attack: 0.005, decay: 0.1, sustain: 0.2, release: 0.1 }
  }).chain(
    new Tone.Distortion(0.8),
    new Tone.Filter(800, "lowpass"),
    new Tone.Gain(0.7),
    Tone.Destination
  );

  // Bass synth with sawtooth wave
  const bass = new Tone.MonoSynth({
    oscillator: { type: "sawtooth" },
    envelope: { attack: 0.01, decay: 0.3, sustain: 0.4, release: 0.3 },
    filterEnvelope: { attack: 0.005, decay: 0.1, sustain: 0.7, release: 0.2, baseFrequency: 100, octaves: 2.6 },
    volume: -6
  }).toDestination();

  // Synth Kick - simple sine wave with short envelope
  const kick = new Tone.MembraneSynth({
    pitchDecay: 0.05,
    octaves: 10,
    envelope: {
      attack: 0.001,
      decay: 0.2,
      sustain: 0,
      release: 0.1
    },
    volume: -8
  }).toDestination();

  // Synth Snare - noise burst + bandpass filter
  const snareNoise = new Tone.NoiseSynth({
    noise: { type: "white" },
    envelope: { attack: 0.001, decay: 0.15, sustain: 0 },
    volume: -12
  });

  const snareFilter = new Tone.Filter(1500, "bandpass").toDestination();
  snareNoise.connect(snareFilter);

  // Basic punk chord roots and power chords
  const powerChords = {
    A: ["A3", "E4"],
    C: ["C4", "G4"],
    D: ["D4", "A4"],
    E: ["E4", "B4"],
    G: ["G3", "D4"]
  };

  function randomChord() {
    const keys = Object.keys(powerChords);
    return keys[Math.floor(Math.random() * keys.length)];
  }

  // Play a 4-chord riff per measure, bass plays root note
  function playPhrase(time) {
    for (let i = 0; i < 4; i++) {
      const chordRoot = randomChord();
      const chordNotes = powerChords[chordRoot];
      const chordTime = time + i * Tone.Time("4n").toSeconds();

      guitar.triggerAttackRelease(chordNotes, "8n", chordTime);
      bass.triggerAttackRelease(chordRoot + "2", "8n", chordTime);
    }

    // Drums:
    // Kick on beats 1 & 3
    kick.triggerAttackRelease("C2", "8n", time);
    kick.triggerAttackRelease("C2", "8n", time + Tone.Time("2n").toSeconds());

    // Snare on beats 2 & 4
    snareNoise.triggerAttackRelease("16n", time + Tone.Time("4n").toSeconds());
    snareNoise.triggerAttackRelease("16n", time + Tone.Time("4n * 3").toSeconds());
  }

  function scheduleLoop() {
    Tone.Transport.scheduleRepeat((time) => {
      playPhrase(time);
      status.textContent += `\nPlaying phrase at ${time.toFixed(2)}s`;
      status.scrollTop = status.scrollHeight;
    }, "1m");
  }

  let isPlaying = false;

  startBtn.onclick = async () => {
    if (isPlaying) return;
    isPlaying = true;
    status.textContent = "Starting audio context...";
    await Tone.start();
    status.textContent += "\nAudio context started.";
    Tone.Transport.start();
    scheduleLoop();
  };

  stopBtn.onclick = () => {
    if (!isPlaying) return;
    isPlaying = false;
    Tone.Transport.stop();
    Tone.Transport.cancel();
    status.textContent += "\nPlayback stopped.";
  };
</script>

</body>
</html>
