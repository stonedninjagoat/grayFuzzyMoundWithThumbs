<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arpeggiated Major7 Hardcore Punk</title>
  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
  <style>
    body { background: #111; color: #eee; font-family: monospace; padding: 1rem; }
    pre { white-space: pre-wrap; background: #222; padding: 1rem; border: 1px solid #555; max-height: 300px; overflow-y: auto; }
    button { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1.1rem; background: #333; color: #eee; border: none; cursor: pointer; }
    button:hover { background: #444; }
  </style>
</head>
<body>

<h2>Hardcore Punk Major7 Arpeggiator</h2>
<button onclick="startJam()">Start Jam</button>
<pre id="log">=== Output Log ===</pre>

<script>
const log = (msg) => {
  const logEl = document.getElementById("log");
  logEl.textContent += "\n" + msg;
  logEl.scrollTop = logEl.scrollHeight;
};

const chords = {
  C: ["C4", "E4", "G4", "B4"],
  D: ["D4", "F#4", "A4", "C#5"],
  E: ["E4", "G#4", "B4", "D#5"],
  F: ["F4", "A4", "C5", "E5"],
  G: ["G4", "B4", "D5", "F#5"],
  A: ["A4", "C#5", "E5", "G#5"],
  B: ["B4", "D#5", "F#5", "A#5"]
};

const rootNotes = Object.keys(chords);

const synth = new Tone.PolySynth(Tone.Synth).toDestination();
const bass = new Tone.MonoSynth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.3, release: 1 } }).toDestination();
const kick = new Tone.MembraneSynth().toDestination();
const snare = new Tone.NoiseSynth({ envelope: { attack: 0.001, decay: 0.2, sustain: 0 } }).toDestination();
const hh = new Tone.MetalSynth({ frequency: 8000, envelope: { attack: 0.001, decay: 0.1, release: 0.1 }, harmonicity: 5.1, modulationIndex: 32 }).toDestination();

let measure = 0;

function scheduleMeasure(measureIndex) {
  const root = rootNotes[Math.floor(Math.random() * rootNotes.length)];
  const notes = chords[root];
  const shuffled = notes.slice().sort(() => Math.random() - 0.5);

  // Arpeggiate guitar
  shuffled.forEach((note, i) => {
    const time = `${measureIndex}m + ${i * 0.25}n`;
    Tone.Transport.scheduleOnce(t => synth.triggerAttackRelease(note, "16n", t), time);
  });

  // Bass root+octave
  const rootNote = root + "2";
  const octaveNote = root + "3";
  for (let i = 0; i < 8; i++) {
    const n = (i % 2 === 0) ? rootNote : octaveNote;
    const time = `${measureIndex}m + ${i * 0.5}n`;
    Tone.Transport.scheduleOnce(t => bass.triggerAttackRelease(n, "8n", t), time);
  }

  // Drums: kick 1/3, snare 2/4, hats 8ths
  for (let i = 0; i < 8; i++) {
    const time = `${measureIndex}m + ${i * 0.5}n`;
    Tone.Transport.scheduleOnce(t => hh.triggerAttackRelease("16n", t), time);
    if (i === 0 || i === 4) Tone.Transport.scheduleOnce(t => kick.triggerAttackRelease("8n", t), time);
    if (i === 2 || i === 6) Tone.Transport.scheduleOnce(t => snare.triggerAttackRelease("16n", t), time);
  }

  log(`Measure ${measureIndex + 1}: ${root}maj7 â†’ ${shuffled.join(" ")}`);
}

function startJam() {
  Tone.start().then(() => {
    Tone.Transport.bpm.value = 220;
    measure = 0;
    Tone.Transport.scheduleRepeat(time => {
      scheduleMeasure(measure);
      measure++;
    }, "1m");
    Tone.Transport.start();
  });
}
</script>

</body>
</html>
