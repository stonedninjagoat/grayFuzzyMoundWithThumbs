<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSV to MIDI Converter</title>
  <script src="https://cdn.jsdelivr.net/npm/jsmidgen@latest/dist/jsmidgen.min.js"></script>
</head>
<body>
  <h2>CSV to MIDI Converter</h2>
  <input type="file" id="csvFile" accept=".csv" />
  <button onclick="downloadMIDI()">Download MIDI</button>

  <script>
    let midiNotes = [];

    document.getElementById('csvFile').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const contents = e.target.result;
        parseCSV(contents);
      };
      reader.readAsText(file);
    });

    function parseCSV(csvData) {
      const lines = csvData.trim().split(/\r?\n/);
      midiNotes = [];

      for (let line of lines) {
        const parts = line.split(','); // In case it's comma-separated
        for (let part of parts) {
          const note = parseInt(part.trim());
          if (!isNaN(note)) {
            midiNotes.push(note);
          }
        }
      }

      alert(`Parsed ${midiNotes.length} MIDI notes.`);
    }

    function downloadMIDI() {
      if (midiNotes.length === 0) {
        alert("No MIDI notes loaded. Please upload a CSV first.");
        return;
      }

      const file = new Midi.File();
      const track = new Midi.Track();
      file.addTrack(track);

      const duration = 64; // Fixed duration for each note
      for (let note of midiNotes) {
        track.addNote(0, note, duration);
      }

      const midiData = file.toBytes();
      const blob = new Blob([new Uint8Array(midiData.split('').map(c => c.charCodeAt(0)))], {
        type: 'audio/midi'
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'output.mid';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
